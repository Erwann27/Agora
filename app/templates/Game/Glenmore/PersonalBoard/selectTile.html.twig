{#
This section displays the player tile resources and possible actions
@param : player, selectedTile
@return :
#}

{# Constants definition, same as in GlenmoreParameters for better transmission in the controller#}
{% set VILLAGER = 'villager' %}
{% set PRODUCTION = 'production' %}
{% set NORTH = 0 %}
{% set NORTH_EAST = 1 %}
{% set EAST = 2 %}
{% set SOUTH_EAST = 3 %}
{% set SOUTH = 4 %}
{% set SOUTH_WEST = 5 %}
{% set WEST = 6 %}
{% set NORTH_WEST = 7 %}

{# Variable definition #}
{% set resources = selectedTile.playerTileResource %}
{% set villager = null %}

<div id="selectedTileActions"
     class="absolute top-0 left-0 w-full h-full bg-black bg-opacity-70 flex z-50 text-white items-center justify-center">


    <div class="bg-green-950 p-5 w-3/4 h-3/4 rounded-lg flex flex-col">

        <div class="grid grid-cols-3
                    gap-5 grid-rows-1 h-full w-full"
        >

        {% set ind = 0 %}
        {% for playerResource in resources %}
            {# Placement of the villager #}
            {% if playerResource.resource.type == VILLAGER %}
                <div class="flex items-center justify-center">
                    <img class="items-center justify-center max-h-full"
                         src="{{ asset('resourcesGames/Glenmore/figure.png') }}" alt="villager"
                    />
                </div>
                {% set villager = playerResource %}
            {% endif %}
        {% endfor %}

        {# Display the tile regarding the phase of the player's round #}
            {% if not activatedMovementPhase or villager == null %}
                <div class="flex items-center justify-center">
                    <img id='image_tile_{{ selectedTile.id }}'
                         class="items-center justify-center rounded-lg shadow-black shadow-lg max-h-full"
                         src="{{
                         asset('resourcesGames/Glenmore/BoardTiles/'
                             ~ selectedTile.tile.id ~ '.svg')
                         }}"
                         alt="{{ 'selectedTile' ~ selectedTile.tile.id }}"
                    >
                </div>
            {% else %}
            <div class="flex items-center justify-center">
                <button class="w-6 flex items-center justify-center">
                    <span class="-rotate-90 whitespace-nowrap">Déplacer le villageois vers la gauche</span>
                </button>
                <div class="flex-1 flex flex-col">
                    <button class="h-6 whitespace-nowrap">Déplacer le villageois vers le haut</button>
                    <img id='image_tile_{{ selectedTile.id }}'
                         class="flex-1 items-center justify-center rounded-lg shadow-black shadow-lg max-h-full"
                         src="{{
                         asset('resourcesGames/Glenmore/BoardTiles/'
                             ~ selectedTile.tile.id ~ '.svg')
                         }}"
                         alt="{{ 'selectedTile' ~ selectedTile.tile.id }}"
                    >
                    <button class="h-6 whitespace-nowrap">Déplacer le villageois vers le bas</button>
                </div>
                <button class="w-6 flex items-center justify-center">
                    <span class="rotate-90 whitespace-nowrap">Déplacer le villageois vers la droite</span>
                </button>
            </div>
            {% endif %}

        {# Display the productions #}
            <div class="{% if not activatedResourceSelection %} hidden {% endif %} grid grid-rows-4 grid-cols-1 gap-1 ">
                <span class="border-white border-2 bg-green-700 text-white text-lg flex items-center border-solid text-center">
                    Choisir les ressources à utiliser
                </span>

                {% for playerResource in resources %}

                    {% if playerResource.resource.type == PRODUCTION %}
                        <button {% if not activatedResourceSelection %} disabled {% endif %}
                                {{ stimulus_action('glenmore', 'selectResource', 'click',
                                    {url:path('app_game_glenmore_select_resource',
                                        {idGame: game.id, idPlayerTileResource : playerResource.id, idTile : selectedTile.id})
                                    })
                                }}
                                class="flex items-center justify-center w-full h-full">
                            <img class="max-h-full"
                                 src="{{
                                 asset('resourcesGames/Glenmore/ResourcesProduction/'
                                     ~ playerResource.resource.color ~'.png')
                                 }}"
                                 alt="{{ playerResource.resource.color }}"
                            />
                        </button>
                    {% endif %}

                {% endfor %}
            </div>
        </div>

        <div class="relative flex flex-row p-5">
            {# Display villager option #}

            {% if activatedMovementPhase and villager != null %}
                <div class="absolute flex items-center justify-center left-0 bottom-1">
                    <button
                            {{ stimulus_action('glenmore', 'removeVillager', 'click',
                                {url:path('app_game_glenmore_remove_villager',
                                    {idGame: game.id, idPlayerTileResource : villager.id, idTile : selectedTile.id})
                                })
                            }}
                            class="bg-[#8F901F] py-2 px-3 m-1 rounded-lg text-2xl
                                    flex items-center justify-center w-full h-full">
                        Retirer le villageois du plateau
                    </button>
                </div>
            {% endif %}

            {% if not activatedMovementPhase and not activatedResourceSelection and not activatedNewResourceAcquisition %}
                <div class="absolute flex items-center justify-center left-0 bottom-1">
                    <button
                            {{ stimulus_action('glenmore', 'activateTile', 'click',
                                {url:path('app_game_glenmore_activate_tile',
                                    {idGame: game.id, idPlayerTileResource : villager.id, idTile : selectedTile.id})
                                })
                            }}
                            class="bg-[#8F901F] py-2 px-3 m-1 rounded-lg text-2xl
                                    flex items-center justify-center w-full h-full"
                    >
                        Activer la tuile
                    </button>
                </div>
            {% endif %}

            <button id="return_board" onclick="closeSelectedTileWindow()"
                    class="absolute rounded-lg bg-[#8F901F] py-2 px-3 m-1 text-2xl right-0 bottom-1 items-center"
            >
                <img src="{{ asset('resourcesGames/utils/return-arrow.svg') }}" id="returnArrow"
                     alt="return on board"
                     class="h-8 max-h-full">
            </button>
        </div>
    </div>
</div>