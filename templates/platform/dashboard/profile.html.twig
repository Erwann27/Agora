{% extends 'platform/dashboard/layout.html.twig' %}

{% block title %}
	Profile page
{% endblock %}

{% block content %}
	<style>
   .table-container {
   border-collapse: separate;
   border-spacing: 0 8px;
   }
   .search-label {
   display: block;
   margin-bottom: 0.5rem; /* Ajoute de l'espace entre les libellés et les menus déroulants */
   }
   .search-form-container {
   display: flex;
   justify-content: center; /* Centrer horizontalement */
   margin-bottom: 2rem; /* Ajouter de l'espace en bas */
   }
   .search-form-container .w-full {
   margin-right: 5rem; /* Ajouter un espace horizontal entre chaque filtre */
   }
</style>
	<div class="bg-gray-100">
		<div class="w-full text-white bg-main-color">
			<div class="flex flex-col max-w-screen-xl px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8">
				<div class="p-4 flex flex-row items-center justify-between">
					<button class="md:hidden rounded-lg focus:outline-none focus:shadow-outline">
						<svg fill="currentColor" viewbox="0 0 20 20" class="w-6 h-6">
							<path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path>
							<path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
						</svg>
					</button>
				</div>
			</div>
		</div>
		<div class="container mx-auto my-5 p-5">
			<div class="md:flex no-wrap md:-mx-2 ">
				<div class="w-full md:w-3/12 md:mx-2">
					<div class="bg-white p-3 border-t-4 border-green-400">
						<div class="image overflow-hidden">
							<img class="h-auto w-full mx-auto" src="https://lavinephotography.com.au/wp-content/uploads/2017/01/PROFILE-Photography-112.jpg" alt="">
						</div>
						<h1 class="text-gray-900 font-bold text-xl leading-8 my-1 capitalize">{{ app.user.username }}
						</h1>
						<h3 class="text-gray-600 font-lg text-semibold leading-6">{{app.user.email}}</h3>
						<p class="text-sm text-gray-500 hover:text-gray-600 leading-6">une description</p>
						<ul class="bg-gray-100 text-gray-600 hover:text-gray-700 hover:shadow py-2 px-3 mt-3 divide-y rounded shadow-sm">
							<li class="flex items-center py-3">
								<span>Member depuis</span>
								<span class="ml-auto">07 Mars, 2024</span>
							</li>
							<li class="flex items-center py-3">
								<span>Statut</span>
								<span class="ml-auto">
									<span class="bg-green-500 py-1 px-2 rounded text-white text-sm">Active</span>
								</span>
							</li>
						</ul>
					</div>
					<div class="bg-white p-3 hover:shadow mt-4">
						<div class="flex items-center space-x-3 font-semibold text-gray-900 text-xl leading-8">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
								<path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"/>
							</svg>
							<span>Favorite Games</span>
						</div>
						<div class="grid grid-cols-3">
							<div class="text-center my-2">
								<img class="h-16 w-16 rounded-full mx-auto" src="" alt="">
								<a href="#" class="text-main-color"></a>
							</div>
						</div>
					</div>
				</div>
				<div class="w-full md:w-9/12 mx-2 h-64">
					<div class="bg-white p-3 shadow-sm rounded-sm">
						<div class="flex items-center space-x-2 font-semibold text-gray-900 leading-8">
							<span clas="text-green-500">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
									<path stroke-linecap="round" stroke-linejoin="round" d="M14.25 6.087c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.036-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959v0a.64.64 0 0 1-.657.643 48.39 48.39 0 0 1-4.163-.3c.186 1.613.293 3.25.315 4.907a.656.656 0 0 1-.658.663v0c-.355 0-.676-.186-.959-.401a1.647 1.647 0 0 0-1.003-.349c-1.036 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401v0c.31 0 .555.26.532.57a48.039 48.039 0 0 1-.642 5.056c1.518.19 3.058.309 4.616.354a.64.64 0 0 0 .657-.643v0c0-.355-.186-.676-.401-.959a1.647 1.647 0 0 1-.349-1.003c0-1.035 1.008-1.875 2.25-1.875 1.243 0 2.25.84 2.25 1.875 0 .369-.128.713-.349 1.003-.215.283-.4.604-.4.959v0c0 .333.277.599.61.58a48.1 48.1 0 0 0 5.427-.63 48.05 48.05 0 0 0 .582-4.717.532.532 0 0 0-.533-.57v0c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.035 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.37 0 .713.128 1.003.349.283.215.604.401.96.401v0a.656.656 0 0 0 .658-.663 48.422 48.422 0 0 0-.37-5.36c-1.886.342-3.81.574-5.766.689a.578.578 0 0 1-.61-.58v0Z"/>
								</svg>

							</span>
							<span class="tracking-wide">Parties en cours</span>
							<div class="flex gap-2">
								<div></div>
								<div></div>
								<div></div>
							</div>
						</div>
						<div class="text-gray-700">
							<div> 
							
							<div class="mx-auto max-w-7xl px-6 lg:px-8 mt-16">
    
      <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
         <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 border border-gray-300">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
               <tr>
                  <th scope="col" class="px-3 py-3 text-center">
                     Jeux
                  </th>
                  <th scope="col" class="px-3 py-3">
                     Informations
                  </th>
                  <th scope="col" class="px-20 py-3">
                     Joueurs
                  </th>
                  <th scope="col" class="px-3 py-3">
                     Action
                  </th>
               </tr>
            </thead>
            {% if app.user is not null %}
            {% set currentUserID = app.user.id %}
            {% endif %}
            <tbody>
               {% for board in boards %}
               {% set users = board.listUsers %}
               {% set availableSeats = board.getNbAvailbleSlots() %}
               {% set colorClass = board.status == 'IN_GAME' ? 'bg-gradient-to-r from-transparent to-orange-200' : (board.isAvailble() ? 'bg-gradient-to-r from-transparent to-green-200' : 'bg-gradient-to-r from-transparent to-red-200') %}
               {% set usersIds = users|map(user => user.id) %}
			   {% set usersInTable = usersIds|filter(id => id == currentUserID) %}


			   {% if usersInTable|length > 0 and board.status == 'IN_GAME' %} {# Vérifie si l'utilisateur est dans la table et si la partie est en cours #}

               <tr class="{{ colorClass }} border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                  <td class="p-2 text-center">
                     {% if board.game is not empty %}
                     <a href="{{ path('app_game_description', {'game_id': board.game.id}) }}">
                     <img src="{{ asset(board.game.imgURL) }}" class="w-32 h-16 md:w-24 md:h-24 rounded-md mx-auto" alt="{{ board.game.name }}">
                     </a>
                     {% else %}
                     <span class="text-red-500">Image non disponible</span>
                     {% endif %}
                  </td>
                  <td class="px-3 py-4 font-semibold text-gray-900 dark:text-white">
                     <div class="text-black font-bold">{{ board.game.name }}</div>
                     </br>
                     <div>Places disponibles : {{ availableSeats }}</div>
                     <div>Status : 
                        {% if board.status == 'WAITING' %}
                        En attente
                        {% elseif board.status == 'IN_GAME' %}
                        En cours
                        {% elseif board.status == 'FINISH' %}
                        Terminé
                        {% endif %}
                     </div>
                     <div>Accessibilité : 
                        {% if board.isAvailble() == true %}
                        Ouverte
                        {% elseif board.isAvailble() == false %}
                        Fermé
                        {% endif %}
                     </div>
                     <div>Date de création : Le {{ board.creationdate|date('d-m-Y à H:i') }}</div>
                  </td>
                  <td class="px-20 py-4">
                     <table class="w-full text-xs text-gray-500 dark:text-gray-400 table-container">
                        {% set usersCount = users|length %}
                        {% set maxUsers = board.getNbUserMax() %}
                        {% set rows = (maxUsers / 4)|round(0, 'ceil') %}
                        {% set cellWidth = 100 / 4 %}
                        {% for row in 1..rows %}
                        <tr>
                           {% for column in 1..4 %}
                           {% set userIndex = (row - 1) * 4 + column - 1 %}
                           {% set user = userIndex < usersCount ? users[userIndex] : null %}
                           <td style="width: {{ cellWidth }}%;{% if column < 4 %} margin-right: 1%;{% endif %}">
                              {% if user %}
                              <div style="width: 80px; margin: 0 auto;">
                                 <a href="/" class="flex items-center justify-center">
                                    <div style="text-align: center;">
                                       <img src="https://avatarfiles.alphacoders.com/244/thumb-244471.png" alt="Avatar de {{ user.username }}" class="w-8 h-8 rounded-full object-cover mb-1">
                                       <div class="text-black font-bold">{{ user.username }}</div>
                                    </div>
                                 </a>
                              </div>
                              {% endif %}
                           </td>
                           {% endfor %}
                        </tr>
                        {% endfor %}
                     </table>
                  </td>
                  <td class="px-3 py-4">
                     {% if app.user %}
                     {% if currentUserID in usersIds %}
                     {% if board.status == 'IN_GAME' %}
                     <a href="/" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                     Reprendre
                     </a>
                     {% else %}
                     <a href="{{ path('app_leave_board', {'id': board.id}) }}" class="text-white bg-red-500 hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                     Quitter
                     </a>
                     {% endif %}
                     {% endif %}
                     {% endif %}
                  </td>
               </tr>
			   {% endif %}
               {% endfor %}
            </tbody>
         </table>
      </div>
   </div>

							
							</div>
						</div>
					</div>
					<div class="bg-white p-3 shadow-sm rounded-sm mt-4">

						<div class="grid grid-cols-2">
							<div>
								<div class="flex items-center space-x-2 font-semibold text-gray-900 leading-8 mb-3">
									<span clas="text-green-500">
										<svg class="h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke="currentColor">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
										</svg>
									</span>
									<span class="tracking-wide">Historique des matches</span>
								</div>
								<ul class="list-inside space-y-2">
									{{dump(app.user)}}

								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
   // Fonction pour soumettre automatiquement le formulaire lorsqu'une sélection change
   function submitSearchForm() {
       document.getElementById('searchForm').submit();
   }
   
   // Ajouter des écouteurs d'événements pour les changements de sélection
   document.getElementById('statusSelect').addEventListener('change', submitSearchForm);
   document.getElementById('availabilitySelect').addEventListener('change', submitSearchForm);
   document.getElementById('datecreationSelect').addEventListener('change', submitSearchForm);
   document.getElementById('gameSelect').addEventListener('change', submitSearchForm);
</script>
{% endblock %}
