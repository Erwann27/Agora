{% extends 'platform/dashboard/layout.html.twig' %}

{% block title %}
	Profile page
{% endblock %}

{% block content %}
	<div class="bg-gray-100">
		<div class="container mx-auto p-5">
			<div class="md:flex no-wrap md:-mx-2 ">
				<div class="w-full md:w-3/12 md:mx-2">
					<div class="bg-white p-3 border-t-4 border-green-400">
						<h1 class="text-gray-900 font-bold text-xl leading-8 my-1 capitalize">{{ app.user.username }}
						</h1>
						<h3 class="text-gray-600 font-lg text-semibold leading-6">{{app.user.email}}</h3>
						<p class="text-sm text-gray-500 hover:text-gray-600 leading-6">une description</p>
						<ul class="bg-gray-100 text-gray-600 hover:text-gray-700 hover:shadow py-2 px-3 mt-3 divide-y rounded shadow-sm">
							<li class="flex items-center py-3">
								<span>Member depuis</span>
								<span class="ml-auto">07 Mars, 2024</span>
							</li>
							<li class="flex items-center py-3">
								<span>Statut</span>
								<span class="ml-auto">
									<span class="bg-green-500 py-1 px-2 rounded text-white text-sm">Active</span>
								</span>
							</li>
						</ul>
					</div>
					<div class="bg-white p-3 hover:shadow mt-4">
						<div class="flex items-center space-x-3 font-semibold text-gray-900 text-xl leading-8">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
								<path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"/>
							</svg>
							<span>Favorite Games</span>
						</div>
						<div class="grid grid-cols-3">
						    {% for game in fav_games %}
							<div class="text-center my-4">
								<a href="{{path('app_game_description', {'game_id': game.id}) }}">
								    <img class="w-32 h-16 md:w-20 md:h-20 rounded-md mx-auto" src="{{ asset(game.imgURL) }}" alt="{{ game.name }}" />
								</a>
							</div>
							{% endfor %}
						</div>
					</div>
				</div>
				<div class="w-full md:w-9/12 mx-2 h-64 space-y-2">
					<details class="bg-white p-3 shadow-sm rounded-sm hover:cursor-pointer">
					    <summary class="font-semibold text-gray-900 leading-8 tracking-wide">
                            Parties en cours
						</summary>
						<div class="text-gray-700">
							<div class="text-sm">
                                {{ block('profile_games_in_progress_section') }}
							</div>
						</div>
					</details>
					<details class="bg-white p-3 shadow-sm rounded-sm hover:cursor-pointer space-y-2">
					    <summary class="font-semibold text-gray-900 leading-8 tracking-wide">
                            Historique des matches
						</summary>
						<div class="text-gray-700 text-sm">
                            {{ block('profile_games_history') }}
						</div>
					</details>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block profile_games_in_progress_section %}
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 border border-gray-300">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                  <th scope="col" class="px-3 py-3 text-center">
                       Aperçu
                  </th>
                  <th scope="col" class="px-3 py-3">
                       Informations
                  </th>
                  <th scope="col" class="px-20 py-3">
                       Joueurs
                  </th>
                  <th scope="col" class="px-3 py-3">
                       Action
                  </th>
              </tr>
          </thead>
          {% if app.user is not null %}
              {% set currentUserID = app.user.id %}
          {% endif %}
          <tbody>
              {% for board in current_boards %}
                  {% set users = board.listUsers %}
                  {% set availableSeats = board.getNbAvailbleSlots() %}
                  {% set colorClass =
    board.isAvailble() ? 'bg-gradient-to-r from-transparent to-green-200' : 'bg-gradient-to-r from-transparent to-red-200'
    %}
                  {% set usersIds = users|map(user => user.id) %}
                  <tr class="{{ colorClass }} border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                       <td class="p-2 text-center">
                           {% if board.game is not empty %}
                                <a href="/lien_vers_image">
                                     <img src="{{ asset(board.game.imgURL) }}" class="w-32 h-16 md:w-24 md:h-24 rounded-md mx-auto" alt="{{ board.game.name }}">
                                </a>
                           {% else %}
                                <span class="text-red-500">Image non disponible</span>
                           {% endif %}
                       </td>
                       <td class="px-3 py-4 font-semibold text-gray-900 dark:text-white">
                           <div>
                                <a href="/lien_vers_description_jeu" class="text-blue-500 hover:underline">Nom du jeu</a>
                           </div>
                           <div>Places disponibles :
                                {{ availableSeats }}</div>
                           <div>Status:
                                {% if board.status == 'WAITING' %}
                                     En attente
                                {% elseif board.status == 'IN_GAME' %}
                                     En cours
                                {% elseif board.status == 'FINISH' %}
                                     Terminé
                                {% endif %}
                           </div>
                           <div>Accessibilité :
                                {% if board.isAvailble() == true %}
                                     Ouverte
                                {% elseif board.isAvailble() == false %}
                                     Fermé
                                {% endif %}
                           </div>
                           <div>Date de création: Le
                                {{ board.creationdate|date('d-m-Y à H:i') }}</div>
                       </td>
                       <td class="px-20 py-4">
                           <table class="w-full text-xs text-gray-500 dark:text-gray-400 table-container">
                                {% set usersCount = users|length %}
                                {% set maxUsers = board.getNbUserMax() %}
                                {% set rows = (maxUsers / 4)|round(0, 'ceil') %}
                                {% set cellWidth = 100 / 4 %}
                                {% for row in 1..rows %}
                                     <tr>
                                         {% for column in 1..4 %}
                                              {% set userIndex = (row - 1) * 4 + column - 1 %}
                                              {% set user = userIndex < usersCount ? users[userIndex] : null %}
                                              <td style="width: {{ cellWidth }}%;{% if column < 4 %} margin-right: 1%;{% endif %}">
                                                  {% if user %}
                                                       <div style="width: 50px; margin: 0 auto;">
                                                            <a href="/" class="flex items-center justify-center">
                                                                 <div style="text-align: center;">
                                                                     <img src="https://avatarfiles.alphacoders.com/244/thumb-244471.png" alt="Avatar de {{ user.username }}" class="w-8 h-8 rounded-full object-cover mb-1">
                                                                     <div>{{ user.username }}</div>
                                                                 </div>
                                                            </a>
                                                       </div>
                                                  {% endif %}
                                              </td>
                                         {% endfor %}
                                     </tr>
                                {% endfor %}
                           </table>
                       </td>
                       <td class="px-3 py-4">
                           {% if app.user %}
                                {% if currentUserID in usersIds %}
                                     {% if board.status == 'IN_GAME' %}
                                         <a href="/" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                              Reprendre
                                         </a>
                                     {% else %}
                                         <a href="{{ path('app_leave_board', {'id': board.id}) }}" class="text-white bg-red-500 hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                              Quitter
                                         </a>
                                     {% endif %}
                                {% else %}
                                     {% if board.status == 'IN_GAME' %}
                                         <a href="/" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                              Voir partie
                                         </a>
                                     {% elseif board.status == 'WAITING' %}
                                         {% if board.isAvailble() == true and availableSeats > 0 %}
                                              <a href="{{ path('app_join_board', {'id': board.id}) }}" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                                  Rejoindre
                                              </a>
                                         {% endif %}
                                     {% endif %}
                                {% endif %}
                           {% endif %}
                       </td>
                  </tr>
              {% endfor %}
          </tbody>
    </table>
{% endblock %}

{% block profile_games_history %}
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 border border-gray-300">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                  <th scope="col" class="px-3 py-3 text-center">
                       Aperçu
                  </th>
                  <th scope="col" class="px-3 py-3">
                       Informations
                  </th>
                  <th scope="col" class="px-20 py-3">
                       Joueurs
                  </th>
                  <th scope="col" class="px-3 py-3">
                       Action
                  </th>
              </tr>
          </thead>
          {% if app.user is not null %}
              {% set currentUserID = app.user.id %}
          {% endif %}
          <tbody>
              {% for board in past_boards %}
                  {% set users = board.listUsers %}
                  {% set availableSeats = board.getNbAvailbleSlots() %}
                  {% set colorClass =
    board.isAvailble() ? 'bg-gradient-to-r from-transparent to-green-200' : 'bg-gradient-to-r from-transparent to-red-200'
    %}
                  {% set usersIds = users|map(user => user.id) %}
                  <tr class="{{ colorClass }} border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                       <td class="p-2 text-center">
                           {% if board.game is not empty %}
                                <a href="/lien_vers_image">
                                     <img src="{{ asset(board.game.imgURL) }}" class="w-32 h-16 md:w-24 md:h-24 rounded-md mx-auto" alt="{{ board.game.name }}">
                                </a>
                           {% else %}
                                <span class="text-red-500">Image non disponible</span>
                           {% endif %}
                       </td>
                       <td class="px-3 py-4 font-semibold text-gray-900 dark:text-white">
                           <div>
                                <a href="/lien_vers_description_jeu" class="text-blue-500 hover:underline">Nom du jeu</a>
                           </div>
                           <div>Places disponibles :
                                {{ availableSeats }}</div>
                           <div>Status:
                                {% if board.status == 'WAITING' %}
                                     En attente
                                {% elseif board.status == 'IN_GAME' %}
                                     En cours
                                {% elseif board.status == 'FINISH' %}
                                     Terminé
                                {% endif %}
                           </div>
                           <div>Accessibilité :
                                {% if board.isAvailble() == true %}
                                     Ouverte
                                {% elseif board.isAvailble() == false %}
                                     Fermé
                                {% endif %}
                           </div>
                           <div>Date de création: Le
                                {{ board.creationdate|date('d-m-Y à H:i') }}</div>
                       </td>
                       <td class="px-20 py-4">
                           <table class="w-full text-xs text-gray-500 dark:text-gray-400 table-container">
                                {% set usersCount = users|length %}
                                {% set maxUsers = board.getNbUserMax() %}
                                {% set rows = (maxUsers / 4)|round(0, 'ceil') %}
                                {% set cellWidth = 100 / 4 %}
                                {% for row in 1..rows %}
                                     <tr>
                                         {% for column in 1..4 %}
                                              {% set userIndex = (row - 1) * 4 + column - 1 %}
                                              {% set user = userIndex < usersCount ? users[userIndex] : null %}
                                              <td style="width: {{ cellWidth }}%;{% if column < 4 %} margin-right: 1%;{% endif %}">
                                                  {% if user %}
                                                       <div style="width: 50px; margin: 0 auto;">
                                                            <a href="/" class="flex items-center justify-center">
                                                                 <div style="text-align: center;">
                                                                     <img src="https://avatarfiles.alphacoders.com/244/thumb-244471.png" alt="Avatar de {{ user.username }}" class="w-8 h-8 rounded-full object-cover mb-1">
                                                                     <div>{{ user.username }}</div>
                                                                 </div>
                                                            </a>
                                                       </div>
                                                  {% endif %}
                                              </td>
                                         {% endfor %}
                                     </tr>
                                {% endfor %}
                           </table>
                       </td>
                       <td class="px-3 py-4">
                           {% if app.user %}
                                {% if currentUserID in usersIds %}
                                     {% if board.status == 'IN_GAME' %}
                                         <a href="/" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                              Reprendre
                                         </a>
                                     {% else %}
                                         <a href="{{ path('app_leave_board', {'id': board.id}) }}" class="text-white bg-red-500 hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                              Quitter
                                         </a>
                                     {% endif %}
                                {% else %}
                                     {% if board.status == 'IN_GAME' %}
                                         <a href="/" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                              Voir partie
                                         </a>
                                     {% elseif board.status == 'WAITING' %}
                                         {% if board.isAvailble() == true and availableSeats > 0 %}
                                              <a href="{{ path('app_join_board', {'id': board.id}) }}" class="text-white bg-primary hover:bg-blue-400 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-semibold rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                                                  Rejoindre
                                              </a>
                                         {% endif %}
                                     {% endif %}
                                {% endif %}
                           {% endif %}
                       </td>
                  </tr>
              {% endfor %}
          </tbody>
    </table>
{% endblock %}


