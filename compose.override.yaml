version: '3'

services:
  agora:
    command: bash -c "cd /app/public
      && symfony console doctrine:migrations:migrate
      && symfony console --env=test doctrine:migrations:migrate
      && (php bin/console tailwind:build --watch &)"
    volumes:
      - ./app:/app/public
      - /app/public/vendor
      - /app/public/var
    environment:
      APP_DEBUG: 1
      APP_ENV: ${APP_ENV_DEV}
      MERCURE_PUBLIC_URL: ${MERCURE_PUBLIC_URL:-https://localhost/.well-known/mercure}
    tty: true


  ###> doctrine/doctrine-bundle ###
###< doctrine/doctrine-bundle ###

###> symfony/mailer ###
  mailer:
    container_name: mailer
    image: schickling/mailcatcher
    ports: ["1025", "1080"]
###< symfony/mailer ###

###> symfony/mercure-bundle ###
###< symfony/mercure-bundle ###
